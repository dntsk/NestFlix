# Руководство по логированию

## Обзор

Проект использует библиотеку **Loguru** для структурированного и эффективного логирования.

## Конфигурация

Настройки логирования находятся в `catalog/logger.py`:

- **Консольный вывод**: INFO и выше, с цветовым выделением
- **Файловое логирование**:
  - `logs/movie_tracker.log` - все сообщения (DEBUG+)
  - `logs/errors.log` - только ошибки (ERROR+)
- **Ротация**: 10 МБ с автоматической архивацией в ZIP
- **Хранение**: 30 дней для основных логов, 60 дней для ошибок

## Использование

### Базовый импорт

```python
from .logger import logger, mask_sensitive
```

### Примеры логирования

```python
# Информационные сообщения
logger.info("Пользователь успешно авторизован")

# Отладочная информация
logger.debug(f"Получено {count} записей из API")

# Ошибки
logger.error(f"Не удалось подключиться к API: {error}")

# Предупреждения
logger.warning("API ключ не настроен")
```

### Маскировка чувствительных данных

```python
# Маскировка API ключей и токенов
api_key = "1234567890abcdef1234567890abcdef"
logger.info(f"API key: {mask_sensitive(api_key)}")
# Вывод: API key: 1234...cdef

# Короткие значения полностью скрываются
short_value = "123"
logger.info(f"Value: {mask_sensitive(short_value)}")
# Вывод: Value: ***
```

## Уровни логирования

| Уровень  | Использование |
|----------|---------------|
| DEBUG    | Детальная отладочная информация для разработки |
| INFO     | Подтверждение нормальной работы приложения |
| WARNING  | Предупреждения о потенциальных проблемах |
| ERROR    | Ошибки, требующие внимания |

## Правила безопасности

⚠️ **НИКОГДА** не логируйте:
- Полные API ключи
- Пароли
- Токены авторизации
- Персональные данные пользователей

✅ **ВСЕГДА** используйте `mask_sensitive()` для:
- API ключей (TMDB, Trakt)
- Client ID
- Любых секретных значений

## Просмотр логов

```bash
# Последние записи из основного лога
tail -f logs/movie_tracker.log

# Только ошибки
tail -f logs/errors.log

# Поиск по логам
grep "import" logs/movie_tracker.log
```

## Интеграция в новый код

При добавлении нового функционала:

1. Импортируйте logger в начале файла:
   ```python
   from .logger import logger, mask_sensitive
   ```

2. Замените все `print()` на соответствующие вызовы logger:
   ```python
   # Было
   print(f"Starting task: {task_id}")
   
   # Стало
   logger.info(f"Starting task: {task_id}")
   ```

3. Маскируйте чувствительные данные:
   ```python
   logger.debug(f"API key: {mask_sensitive(api_key)}")
   ```

## Мониторинг в production

Рекомендуется настроить:
- Мониторинг размера директории `logs/`
- Алерты на ERROR сообщения
- Регулярную ротацию логов (автоматическая)
- Бэкап архивов логов
