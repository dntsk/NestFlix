{% extends 'catalog/base.html' %}
{% load i18n %}

{% block title %}{% if is_authenticated %}{% trans "My Collection" %}{% else %}{% trans "Popular Movies" %}{% endif %}{% endblock %}

{% block content %}
<h1>{% if is_authenticated %}{% trans "My Collection" %}{% else %}{% trans "Popular Movies" %}{% endif %}</h1>
{% if not is_authenticated %}
<p>{% trans "Top movies by average user rating" %}</p>
{% endif %}
{% if page_obj %}
<div class="grid" style="grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1rem;">
    {% for user_rating in page_obj %}
    <article style="text-align: center; padding: 1rem; background-color: #ffffff; border: 1px solid var(--border); border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); transition: transform 0.2s; display: flex; flex-direction: column;">
        {% if user_rating.movie.data.poster_path %}
            <a href="{% url 'catalog:movie_detail' user_rating.movie.tmdb_id %}" style="text-decoration: none;">
                <img src="https://image.tmdb.org/t/p/w200{{ user_rating.movie.data.poster_path }}" alt="{{ user_rating.movie.title }}" style="width: 100%; max-width: 200px; border-radius: 8px; margin-bottom: 0.5rem; transition: transform 0.2s;">
            </a>
        {% else %}
            <a href="{% url 'catalog:movie_detail' user_rating.movie.tmdb_id %}" style="text-decoration: none;">
                <div style="width: 200px; height: 300px; background: var(--border); display: flex; align-items: center; justify-content: center; border-radius: 8px; margin: 0 auto 0.5rem; transition: transform 0.2s;">
                    {% trans "No Poster" %}
                </div>
            </a>
        {% endif %}
        <h5 style="margin: 0.5rem 0;"><a href="{% url 'catalog:movie_detail' user_rating.movie.tmdb_id %}" style="text-decoration: none; color: var(--text);">{{ user_rating.movie.title }}</a></h5>
        {% if is_authenticated %}
            <div style="flex: 1; display: flex; flex-direction: column; justify-content: flex-end;">
                {% if user_rating.watched_at %}
                    <p style="margin: 0.5rem 0; color: var(--muted);"><small>{% trans "Watched" %}: {{ user_rating.watched_at|date:"Y-m-d" }}</small></p>
                {% endif %}
                {% if user_rating.rating %}
                    <p style="margin: 0; font-weight: bold; color: var(--accent);">{{ user_rating.rating|floatformat:1 }}/10</p>
                {% endif %}
            </div>
        {% else %}
            <div style="flex: 1; display: flex; flex-direction: column; justify-content: flex-end;">
                {% if user_rating.avg_rating %}
                    <p style="margin: 0.5rem 0; color: var(--accent); font-weight: bold;">{{ user_rating.avg_rating|floatformat:1 }}/10</p>
                {% endif %}
            </div>
        {% endif %}
    </article>
    {% endfor %}
</div>

{% if page_obj.has_other_pages %}
<nav aria-label="Pagination" style="margin-top: 2rem;">
    <ul style="list-style: none; display: flex; gap: 0.5rem; padding: 0; margin-left: auto;">
        <li style="flex: 1;"></li>
        {% if page_obj.has_previous %}
            <li><a href="?page=1" style="padding: 0.5rem 1rem; border: 1px solid var(--border); border-radius: 4px; text-decoration: none; color: var(--primary);">&laquo; {% trans "First" %}</a></li>
            <li><a href="?page={{ page_obj.previous_page_number }}" style="padding: 0.5rem 1rem; border: 1px solid var(--border); border-radius: 4px; text-decoration: none; color: var(--primary);">{% trans "Previous" %}</a></li>
        {% endif %}
        <li style="padding: 0.5rem 1rem; color: var(--muted);">{{ page_obj.number }} {% trans "of" %} {{ page_obj.paginator.num_pages }}</li>
        {% if page_obj.has_next %}
            <li><a href="?page={{ page_obj.next_page_number }}" style="padding: 0.5rem 1rem; border: 1px solid var(--border); border-radius: 4px; text-decoration: none; color: var(--primary);">{% trans "Next" %}</a></li>
            <li><a href="?page={{ page_obj.paginator.num_pages }}" style="padding: 0.5rem 1rem; border: 1px solid var(--border); border-radius: 4px; text-decoration: none; color: var(--primary);">{% trans "Last" %} &raquo;</a></li>
        {% endif %}
    </ul>
</nav>
{% endif %}
{% else %}
<div style="text-align: center; padding: 2rem;">
    <p>{% trans "Your collection is empty." %}</p>
    <a href="{% url 'catalog:movie_search' %}" role="button">{% trans "Add Movie" %}</a>
</div>
{% endif %}
{% endblock %}
